language: node_js

node_js:
  - 16

install:
  - npm install
  - npm install -g @angular/cli

stages:
  - analyse-code
  - build-release-preprod
  - build-release-recette
  - build-release-prod
  
jobs:
  include:
  - stage: analyse-code
    script:
    - npm run lint
  - stage: build-release-preprod
    script: 
    - ng build -c pre-production
    - cd dist/zelli
    - zip -r "${TRAVIS_BUILD_DIR}/zelli_${TRAVIS_TAG}-preprod.zip" * 
    deploy:
      provider: releases
      api_key:
        secure: XI6p4WscSM6jb6sfzrBLWZIPgk5hnRvr8AplbbsY9UvCz4av3rKL+kNp1BqksjU7IG4rlAxQIQ8GFMAsR1IC7SRvjz2mm7cploC6OB493K1AN7+5NbcLbjkCt6+iF37JqRYAL8REw926CArcvtN6CUAkR0c1hjHnOJNO06kGuvAVvIZpKxNk4zHcKpn7LPko9+JRoprx1QXevii2DochYwPeQvow0sNFzJvEipFL4CsbPGCaE92fUp/ihp4nTbukhpR5rPULNO1tM8/Oh8si7XTusjuZVdKdaejvM2GLPaUyVTgNbxiiLr2pHl7OPjuP6aMPXb1UAJeq+aGvL6jVFhB1rU4trv5ylCf+dFUv7r3q6he+MSKd+7r5qEegHB4QlOhtN1G4LzecJgJcWubuoGVk/3EErEeJNN2Ne8DR10aSCnFomaFZvvkYhp0PXKqOYfa241rEXMOBYzKn2d7ArmtZ5fIp0IRkYNwMsHy6EHav1R9dQ73AlGK3zl4NpzNd84s4St5UM13geQG8xsEkDhvY2rB9wf9ujeELO9zzzvvYclEF4rMjS1EnpV2r7LtO4f/mKJDvZUdxz558xexDY/mcT3i01leFSXXhx+BvnxCwVabYxLuMlAyOMNF/dHJtT94JwSo/vWXSRrhhDIWuTrkrfRKA1uk2x2xBDmIVVZg=
      file_glob: true
      file: "${TRAVIS_BUILD_DIR}/*.zip"
      skip_cleanup: true
      on:
        tags: true
  - stage: build-release-recette
    script: 
    - ng build -c R7
    - cd dist/zelli
    - zip -r "${TRAVIS_BUILD_DIR}/zelli_${TRAVIS_TAG}-recette.zip" * 
    deploy:
      provider: releases
      api_key:
        secure: XI6p4WscSM6jb6sfzrBLWZIPgk5hnRvr8AplbbsY9UvCz4av3rKL+kNp1BqksjU7IG4rlAxQIQ8GFMAsR1IC7SRvjz2mm7cploC6OB493K1AN7+5NbcLbjkCt6+iF37JqRYAL8REw926CArcvtN6CUAkR0c1hjHnOJNO06kGuvAVvIZpKxNk4zHcKpn7LPko9+JRoprx1QXevii2DochYwPeQvow0sNFzJvEipFL4CsbPGCaE92fUp/ihp4nTbukhpR5rPULNO1tM8/Oh8si7XTusjuZVdKdaejvM2GLPaUyVTgNbxiiLr2pHl7OPjuP6aMPXb1UAJeq+aGvL6jVFhB1rU4trv5ylCf+dFUv7r3q6he+MSKd+7r5qEegHB4QlOhtN1G4LzecJgJcWubuoGVk/3EErEeJNN2Ne8DR10aSCnFomaFZvvkYhp0PXKqOYfa241rEXMOBYzKn2d7ArmtZ5fIp0IRkYNwMsHy6EHav1R9dQ73AlGK3zl4NpzNd84s4St5UM13geQG8xsEkDhvY2rB9wf9ujeELO9zzzvvYclEF4rMjS1EnpV2r7LtO4f/mKJDvZUdxz558xexDY/mcT3i01leFSXXhx+BvnxCwVabYxLuMlAyOMNF/dHJtT94JwSo/vWXSRrhhDIWuTrkrfRKA1uk2x2xBDmIVVZg=
      file_glob: true
      file: "${TRAVIS_BUILD_DIR}/*.zip"
      skip_cleanup: true
      on:
        tags: true
  - stage: build-release-prod
    script: 
    - ng build -c production
    - cd dist/zelli
    - zip -r "${TRAVIS_BUILD_DIR}/zelli_${TRAVIS_TAG}.zip" * 
    deploy:
      provider: releases
      api_key:
        secure: XI6p4WscSM6jb6sfzrBLWZIPgk5hnRvr8AplbbsY9UvCz4av3rKL+kNp1BqksjU7IG4rlAxQIQ8GFMAsR1IC7SRvjz2mm7cploC6OB493K1AN7+5NbcLbjkCt6+iF37JqRYAL8REw926CArcvtN6CUAkR0c1hjHnOJNO06kGuvAVvIZpKxNk4zHcKpn7LPko9+JRoprx1QXevii2DochYwPeQvow0sNFzJvEipFL4CsbPGCaE92fUp/ihp4nTbukhpR5rPULNO1tM8/Oh8si7XTusjuZVdKdaejvM2GLPaUyVTgNbxiiLr2pHl7OPjuP6aMPXb1UAJeq+aGvL6jVFhB1rU4trv5ylCf+dFUv7r3q6he+MSKd+7r5qEegHB4QlOhtN1G4LzecJgJcWubuoGVk/3EErEeJNN2Ne8DR10aSCnFomaFZvvkYhp0PXKqOYfa241rEXMOBYzKn2d7ArmtZ5fIp0IRkYNwMsHy6EHav1R9dQ73AlGK3zl4NpzNd84s4St5UM13geQG8xsEkDhvY2rB9wf9ujeELO9zzzvvYclEF4rMjS1EnpV2r7LtO4f/mKJDvZUdxz558xexDY/mcT3i01leFSXXhx+BvnxCwVabYxLuMlAyOMNF/dHJtT94JwSo/vWXSRrhhDIWuTrkrfRKA1uk2x2xBDmIVVZg=
      file_glob: true
      file: "${TRAVIS_BUILD_DIR}/*.zip"
      skip_cleanup: true
      on:
        tags: true
       
